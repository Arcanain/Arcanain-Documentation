# Sensing requirement

## Abstract
本ページでは、Sensingに関する要求仕様を記載する。

## GNSS Requirement
GNSSに関する要求仕様を以下に記載する。

| 要求 | GNSS-01 | GNSSセンサから取得されるデータ形式（nmea_msgs/Sentence）をnmea_navsat_driverを用いて緯度・経度・高度のデータ形式（sensor_msgs/NavSatFix）に変換する |
|:---|:---|:---|
|    | **理由** | 扱いやすいデータ構造へ変換し後段に構える処理を実行するため |
|    | **説明** |  |
| **要求** | **GNSS-02** | **緯度・経度・高度を取得し、ECEU座標系及びENU座標系へ変換する** |
|    | **理由** | ローカル座標系（任意の緯度・経度・高度の原点からの座標値）での移動体の位置情報を取得するため |
|    | **説明** | ECEF(Earth-Centered, Earth-Fixed)座標系への変換には、空間直交座標変換(Geodetic to ECEF Coordinates Transformation)という計算式が用いられる。<br/>以下の式が、緯度・経度・高度からECEF座標へ変換する式である。<br/><br/>X = (N + h) * cos(φ) * cos(λ)<br/>Y = (N + h) * cos(φ) * sin(λ)<br/>Z = (N * (1 - e^2) + h) * sin(φ)<br/>ここで、Nは楕円体の扁平率による楕円体の半径、φは緯度、λは経度である。<br/><br/>以下の式が、ECUE座標からECU座標への変換行列は以下の通りである。<br/><br/>[ -sin(φ) cos(φ) 0 <br/> -sin(λ)cos(φ) -sin(λ)sin(φ) cos(λ) <br/> cos(λ)cos(φ) cos(λ)sin(φ) sin(λ) ]<br/>ここで、φは緯度、λは経度である。|
|    |　　| **< 緯度・経度・高度からECEU座標系へ変換 >** |
|    | **GNSS-02.1** | 原点の緯度・経度を定める |
|    | **GNSS-02.2** | 対象の緯度・経度を逐次的に取得する |
|    | **GNSS-02.3** | 測地座標値である緯度・経度を標準極座標値を求める |
|    | **GNSS-02.4** | 測地学に基づき標準極座標値をECEU座標値を求める |
|    |    | **< ECEU座標系からECU座標系へ変換 >**  |
|    | **GNSS-02.5** | 原点と対象のECEU座標値の差分ベクトルを求める |
|    | **GNSS-02.6** | 原点の緯度・経度からECUE座標からECU座標への変換行列を求める |
|    | **GNSS-02.7** | 変換行列と差分ベクトルを掛けてENU座標ベクトルを求める |
| **要求** | **GNSS-03** | **緯度・経度の分散を取得し、外れ値を除去する** |
|    | **理由** | 外れ値を除去することで後段に構える自己位置推定の性能担保をするため |
|    | **説明** | 閾値は性能担保できる範囲で適合できることとする |
|    | **GNSS-03.1** | 緯度・経度の分散を取得する |
|    | **GNSS-03.2** | 分散と事前に定めた外れ値閾値から、外れ値除去判定を行う |
|    | **GNSS-03.3** | 外れ値と判断された場合、取得した緯度・経度をクリアにする |
|    | **GNSS-03.4** | 外れ値と判断されなかった場合、取得した緯度・経度を用いる |

## IMU Requirement
IMUに関する要求仕様を以下に記載する。

| 要求 | IMU-01 | IMUセンサから取得されるバイナリデータをデバイスに対応した任意のドライバを用いて加速度・角速度・地磁気のデータ形式（sensor_msgs/Imu）に変換する |
|:---|:---|:---|
|    | **理由** | 扱いやすいデータ構造へ変換し後段に構える処理を実行するため |
|    | **説明** |  |
| **要求** | **IMU-02** | **IMU生データを取得し、一定時間かけて平均値を演算し、さらに一定時間かけて生データと平均値から静的オフセットを演算する** |
|    | **理由** | IMUの静的オフセットを用いてIMU生データを修正し、後段に構える処理の性能担保するため |
|    | **説明** | 静的オフセットを求める手段はいくつか存在する。<br/><br/>1. 手動オフセット設定: IMUのセンサー値を一定時間収集して、平均値を計算してオフセット値とする方法<br/>2. 平行移動法: ある距離を沿ってIMUを動かし、オフセットを計算する方法<br/>3. 位置固定法: IMUを固定した状態で一定時間収集してオフセットを計算する方法<br/>4. 物体に向かっての角度変換: 物体からIMUを動かし、オフセットを計算する方法 |
|    |  | **< IMU生データから平均値を演算する >** |
|    | **IMU-02.1** | IMUデバイスを固定し、逐次的に加速度・角速度・地磁気を取得する |
|    | **IMU-02.2** | 一定時間の間、生データから平均値を演算する |
|    |  | **< 静的オフセットを演算する >** |
|    | **IMU-02.3** | 逐次的に取得するIMU生データと平均値の差分を演算する |
|    | **IMU-02.4** | 一定時間の間、差分を演算し差分の平均値を静的オフセットとして出力する |

## Camera Requirement

## Lidar Requirement